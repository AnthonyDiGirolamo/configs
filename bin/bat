#!/bin/bash

B0=`cat /sys/devices/platform/smapi/BAT0/installed`
B1=`cat /sys/devices/platform/smapi/BAT1/installed`

main() {
	echo "                    MAIN BATTERY"
	echo "         Installed: `cat /sys/devices/platform/smapi/BAT0/installed`"
	echo "             State: `cat /sys/devices/platform/smapi/BAT0/state`"
	echo "            Cycles: `cat /sys/devices/platform/smapi/BAT0/cycle_count`"
	# echo "       Current now: `cat /sys/devices/platform/smapi/BAT0/current_now`"
	# echo "       Current avg: `cat /sys/devices/platform/smapi/BAT0/current_avg`"
	# echo "         Power now: `cat /sys/devices/platform/smapi/BAT0/power_now`"
	# echo "         Power avg: `cat /sys/devices/platform/smapi/BAT0/power_avg`"
	echo "Last Full Capacity: `cat /sys/devices/platform/smapi/BAT0/last_full_capacity`"
	echo "         Remaining: `cat /sys/devices/platform/smapi/BAT0/remaining_percent`%"
	# echo "  Rem Running Time: `cat /sys/devices/platform/smapi/BAT0/remaining_running_time`"
	# echo "   Rem Charge Time: `cat /sys/devices/platform/smapi/BAT0/remaining_charging_time`"
	echo "      Rem Capacity: `cat /sys/devices/platform/smapi/BAT0/remaining_capacity`"
	echo "   Design Capacity: `cat /sys/devices/platform/smapi/BAT0/design_capacity`"
	# echo "           Voltage: `cat /sys/devices/platform/smapi/BAT0/voltage`"
	# echo "    Design Voltage: `cat /sys/devices/platform/smapi/BAT0/design_voltage`"
	# echo "      Manufacturer: `cat /sys/devices/platform/smapi/BAT0/manufacturer`"
	# echo "             Model: `cat /sys/devices/platform/smapi/BAT0/model`"
	# echo "         Barcoding: `cat /sys/devices/platform/smapi/BAT0/barcoding`"
	# echo "         Chemistry: `cat /sys/devices/platform/smapi/BAT0/chemistry`"
	# echo "            Serial: `cat /sys/devices/platform/smapi/BAT0/serial`"
	# echo "      Manufactured: `cat /sys/devices/platform/smapi/BAT0/manufacture_date`"
	# echo "         First Use: `cat /sys/devices/platform/smapi/BAT0/first_use_date`	"
	echo "       Temperature: `cat /sys/devices/platform/smapi/BAT0/temperature`"
}

aux() {
	echo "                    AUX BATTERY"
	echo "         Installed: `cat /sys/devices/platform/smapi/BAT1/installed`"
	echo "             State: `cat /sys/devices/platform/smapi/BAT1/state`"
	echo "            Cycles: `cat /sys/devices/platform/smapi/BAT1/cycle_count`"
	# echo "       Current now: `cat /sys/devices/platform/smapi/BAT1/current_now`"
	# echo "       Current avg: `cat /sys/devices/platform/smapi/BAT1/current_avg`"
	# echo "         Power now: `cat /sys/devices/platform/smapi/BAT1/power_now`"
	# echo "         Power avg: `cat /sys/devices/platform/smapi/BAT1/power_avg`"
	echo "Last Full Capacity: `cat /sys/devices/platform/smapi/BAT1/last_full_capacity`"
	echo "         Remaining: `cat /sys/devices/platform/smapi/BAT1/remaining_percent`%"
	# echo "  Rem Running Time: `cat /sys/devices/platform/smapi/BAT1/remaining_running_time`"
	# echo "   Rem Charge Time: `cat /sys/devices/platform/smapi/BAT1/remaining_charging_time`"
	echo "      Rem Capacity: `cat /sys/devices/platform/smapi/BAT1/remaining_capacity`"
	echo "   Design Capacity: `cat /sys/devices/platform/smapi/BAT1/design_capacity`"
	# echo "           Voltage: `cat /sys/devices/platform/smapi/BAT1/voltage`"
	# echo "    Design Voltage: `cat /sys/devices/platform/smapi/BAT1/design_voltage`"
	# echo "      Manufacturer: `cat /sys/devices/platform/smapi/BAT1/manufacturer`"
	# echo "             Model: `cat /sys/devices/platform/smapi/BAT1/model`"
	# echo "         Barcoding: `cat /sys/devices/platform/smapi/BAT1/barcoding`"
	# echo "         Chemistry: `cat /sys/devices/platform/smapi/BAT1/chemistry`"
	# echo "            Serial: `cat /sys/devices/platform/smapi/BAT1/serial`"
	# echo "      Manufactured: `cat /sys/devices/platform/smapi/BAT1/manufacture_date`"
	# echo "         First Use: `cat /sys/devices/platform/smapi/BAT1/first_use_date`	"
	echo "       Temperature: `cat /sys/devices/platform/smapi/BAT1/temperature`"
}

usenone() {
	echo "Using AC"
	echo 0 > /sys/devices/platform/smapi/BAT0/force_discharge
	echo 0 > /sys/devices/platform/smapi/BAT1/force_discharge
}

use0() {
	echo "Using Battery 0"
	echo 1 > /sys/devices/platform/smapi/BAT0/force_discharge
	echo 0 > /sys/devices/platform/smapi/BAT1/force_discharge
}

use1() {
	echo "Using Battery 1"
	echo 0 > /sys/devices/platform/smapi/BAT0/force_discharge
	echo 1 > /sys/devices/platform/smapi/BAT1/force_discharge
}

partial() {
	echo "Setting Partial Charge Scheme"
	echo 35 > /sys/devices/platform/smapi/BAT0/start_charge_thresh
	echo 80 > /sys/devices/platform/smapi/BAT0/stop_charge_thresh
	echo 35 > /sys/devices/platform/smapi/BAT1/start_charge_thresh
	echo 80 > /sys/devices/platform/smapi/BAT1/stop_charge_thresh
}

full() {
	echo "Setting Full Charge Scheme"
	echo 96 > /sys/devices/platform/smapi/BAT0/start_charge_thresh
	echo 100 > /sys/devices/platform/smapi/BAT0/stop_charge_thresh
	echo 96 > /sys/devices/platform/smapi/BAT1/start_charge_thresh
	echo 100 > /sys/devices/platform/smapi/BAT1/stop_charge_thresh
}

stat() {
	cat /sys/devices/platform/smapi/BAT1/cycle_count > /dev/null
	if [[ $? -eq "1" ]]; then
		echo "      AC Connected: `cat /sys/devices/platform/smapi/ac_connected`"
		echo
		main
	else
		echo "      AC Connected: `cat /sys/devices/platform/smapi/ac_connected`"
		echo
		main
		echo
		aux
	fi
}

case "$1" in
	usenone)
		usenone
		;;
	use0)
		use0
		;;
	use1)
		use1
		;;
	p)
		partial
		;;
	partial)
		partial
		;;
	f)
		full
		;;
	full)
		full
		;;
	s)
		stat
		;;
	status)
		stat
		;;
	*)
		echo "Usage: usenone | use0 | use1 | (p)artial | (f)ull | (s)tatus"
		echo
		echo "                 MAIN	AUX"
		echo " Start Charging: `cat /sys/devices/platform/smapi/BAT0/start_charge_thresh`	`cat /sys/devices/platform/smapi/BAT1/start_charge_thresh`"
		echo "  Stop Charging: `cat /sys/devices/platform/smapi/BAT0/stop_charge_thresh`	`cat /sys/devices/platform/smapi/BAT1/stop_charge_thresh`"
		echo "Force Discharge: `cat /sys/devices/platform/smapi/BAT0/force_discharge`	`cat /sys/devices/platform/smapi/BAT1/force_discharge`"
		echo " Inhibit Charge: `cat /sys/devices/platform/smapi/BAT0/inhibit_charge_minutes`	`cat /sys/devices/platform/smapi/BAT1/inhibit_charge_minutes`"
		;;
esac

